<!DOCTYPE html>
<html lang="en">
   <head>
      <meta name="generator"
         content="HTML Tidy for HTML5 (experimental) for Windows https://github.com/w3c/tidy-html5/tree/c63cc39" />
      <meta charset="UTF-8" />
      <title>Commission Calculator</title>
      <meta name="viewport" content="width=device-width, initial-scale=1" />
      <style>
         :root {
         --bg: var(--tg-theme-bg-color, #ffffff);
         --text: var(--tg-theme-text-color, #000000);
         --hint: var(--tg-theme-hint-color, #707579);
         --button: var(--tg-theme-button-color, #3390ec);
         --button-text: var(--tg-theme-button-text-color, #ffffff);
         --secondary-bg: var(--tg-theme-secondary-bg-color, #f4f4f5);
         }
         body {
         font-family: -apple-system, BlinkMacSystemFont, &quot;Segoe UI&quot;, Roboto, Helvetica, Arial, sans-serif;
         background-color: var(--secondary-bg);
         color: var(--text);
         margin: 0;
         padding: 16px;
         line-height: 1.5;
         }
         h1 {
         font-size: 22px;
         font-weight: 700;
         margin: 0 0 4px 0;
         }
         .version {
         color: var(--hint);
         font-size: 12px;
         margin-bottom: 20px;
         }
         /* Card-style containers */
         .card {
         background: var(--bg);
         border-radius: 12px;
         padding: 16px;
         margin-bottom: 12px;
         box-shadow: 0 1px 3px rgba(0,0,0,0.1);
         }
         .field {
         display: flex;
         justify-content: space-between;
         align-items: center;
         margin-bottom: 16px;
         }
         .field:last-child { margin-bottom: 0; }
         label {
         font-weight: 500;
         font-size: 15px;
         }
         label small {
         display: block;
         color: var(--hint);
         font-weight: 400;
         }
         /* Quantity controls */
         .qty-box {
         display: flex;
         align-items: center;
         background: var(--secondary-bg);
         border-radius: 8px;
         padding: 4px;
         }
         .qty-box button {
         width: 32px;
         height: 32px;
         border: none;
         border-radius: 6px;
         background: var(--bg);
         color: var(--button);
         font-size: 20px;
         font-weight: bold;
         cursor: pointer;
         }
         .qty-box span {
         padding: 0 12px;
         font-weight: 600;
         min-width: 20px;
         text-align: center;
         }
         /* Hide the old button since we are using the Telegram Main Button */
         #bookBtn {
         display: none;
         }
         .info-text {
         font-size: 13px;
         color: var(--hint);
         text-align: center;
         margin-top: 20px;
         }
      </style>
      <script src="https://telegram.org/js/telegram-web-app.js"></script>
   </head>
   <body>
      <h1>Commission Calculator</h1>
      <p>
         <small>v0.4</small>
      </p>
      <div class="card">
         <div class="field">
            <label>Characters <small>$30 each</small></label>
            <div class="qty-box" data-key="characters">
               <button type="button" data-action="minus">−</button>
               <span data-value>1</span>
               <button type="button" data-action="plus">+</button>
            </div>
         </div>
      </div>
      <div class="card">
         <div class="field">
            <label>Background Crowd <small>$10 each</small></label>
            <div class="qty-box" data-key="backgroundCrowd">
               <button type="button" data-action="minus">−</button>
               <span data-value>0</span>
               <button type="button" data-action="plus">+</button>
            </div>
         </div>
      </div>
      <div class="card">
         <div class="field">
            <label>Alt Pose <small>$15 each</small></label>
            <div class="qty-box" data-key="altPose">
               <button type="button" data-action="minus">−</button>
               <span data-value>0</span>
               <button type="button" data-action="plus">+</button>
            </div>
         </div>
      </div>
      <div class="card">
         <div class="field">
            <label>Alt outfit <small>$10 each</small></label>
            <div class="qty-box" data-key="altOutfit">
               <button type="button" data-action="minus">−</button>
               <span data-value>0</span>
               <button type="button" data-action="plus">+</button>
            </div>
         </div>
      </div>
      <div class="card">
         <div class="field">
            <label>Alt Layer <small>$5 each</small></label>
            <div class="qty-box" data-key="altLayer">
               <button type="button" data-action="minus">−</button>
               <span data-value>0</span>
               <button type="button" data-action="plus">+</button>
            </div>
         </div>
      </div>
      <div class="card">
         <div class="field">
            <label>Additional Panels <small>$10 each</small></label>
            <div class="qty-box" data-key="additionalPanel">
               <button type="button" data-action="minus">−</button>
               <span data-value>1</span>
               <button type="button" data-action="plus">+</button>
            </div>
         </div>
      </div>
      <div class="card">
         <div class="checkbox-row">
            <input type="checkbox" id="simpleBackground" /> 
            <label for="simpleBackground" style="margin: 0">Simple background (-10 USD)</label>
         </div>
      </div>
      <button id="bookBtn" disabled="disabled">Total cost: 0 USD – pick a date now</button>
      <p>
         <small>After clicking the button above, data will be copied into your device&#39;s clipboard, just paste them in the
         appropriate text field after you&#39;ve selected the date.</small>
      </p>
      <script>
         const tg = window.Telegram ? window.Telegram.WebApp : null;

// Ensure the app takes up the full screen
if (tg) {
  tg.expand();
  tg.ready();
}

const state = {
  characters: 1,
  backgroundCrowd: 0,
  altPose: 0,
  altOutfit: 0,
  altLayer: 0,
  additionalPanel: 0,
  simpleBackground: false,
};

const simpleBackgroundCheckbox = document.getElementById("simpleBackground");

function calcTotal() {
  const { characters, backgroundCrowd, altPose, altOutfit, altLayer, additionalPanel, simpleBackground } = state;
  
  let total = 0;
  total += characters * 30;
  total += backgroundCrowd * 10;
  total += altPose * 15;
  total += altOutfit * 10;
  total += altLayer * 5;
  total += additionalPanel * 10;
  if (simpleBackground) total -= 10;
  if (total < 0) total = 0;
  
  // --- TELEGRAM MAIN BUTTON LOGIC ---
  if (tg) {
    if (total > 0) {
      tg.MainButton.setText(`BOOK FOR $${total} USD`);
      tg.MainButton.show();
    } else {
      tg.MainButton.hide();
    }
  }
  
  return { total, characters, backgroundCrowd, altPose, altOutfit, altLayer, additionalPanel, simpleBackground };
}

function renderQuantities() {
  document.querySelectorAll(".qty-box").forEach((box) => {
    const key = box.getAttribute("data-key");
    const span = box.querySelector("[data-value]");
    span.textContent = state[key];
  });
  simpleBackgroundCheckbox.checked = state.simpleBackground;
}

document.querySelectorAll(".qty-box button").forEach((btn) => {
  btn.addEventListener("click", () => {
    const box = btn.closest(".qty-box");
    const key = box.getAttribute("data-key");
    const action = btn.getAttribute("data-action");
    if (action === "plus") {
      state[key] += 1;
    } else if (action === "minus") {
      state[key] = Math.max(0, state[key] - 1);
    }
    
    // Impact feedback on button press
    if (tg) tg.HapticFeedback.impactOccurred('light');
    
    renderQuantities();
    calcTotal();
  });
});

simpleBackgroundCheckbox.addEventListener("change", () => {
  state.simpleBackground = simpleBackgroundCheckbox.checked;
  if (tg) tg.HapticFeedback.impactOccurred('light');
  calcTotal();
});

// Clipboard Helper
async function copyToClipboard(text) {
  try {
    await navigator.clipboard.writeText(text);
    return true;
  } catch (e) {
    // Fallback for older environments
    const textarea = document.createElement("textarea");
    textarea.value = text;
    document.body.appendChild(textarea);
    textarea.select();
    const success = document.execCommand("copy");
    document.body.removeChild(textarea);
    return success;
  }
}

function buildOrderText(order) {
  return (
    `TOTAL PRICE: ${order.total} USD\n` +
    `Characters: ${order.characters}\n` +
    `Background crowd: ${order.backgroundCrowd}\n` +
    `Alt pose: ${order.altPose}\n` +
    `Alt outfit: ${order.altOutfit}\n` +
    `Alt layer: ${order.altLayer}\n` +
    `Additional panels: ${order.additionalPanel}\n` +
    `Simple background: ${order.simpleBackground ? "Yes (-10 USD)" : "No"}\n`
  );
}

// Telegram Main Button Event
if (tg) {
  tg.onEvent('mainButtonClicked', async function() {
    const order = calcTotal();
    const text = buildOrderText(order);
    
    tg.HapticFeedback.notificationOccurred('success');
    await copyToClipboard(text);
    
    tg.showAlert("Order details copied! Redirecting to calendar...", () => {
      tg.openLink("https://calendar.app.google/mEp6KcTrbwNCGTZU8");
    });
  });
}

// Initial Run
renderQuantities();
calcTotal();
      </script>
   </body>
</html>
